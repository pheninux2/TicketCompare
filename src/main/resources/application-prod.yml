# ===================================
# Configuration TicketCompare - PRODUCTION
# Profil: prod (avec PostgreSQL)
# ===================================

spring:
  # ===================================
  # Base de donn√©es PostgreSQL
  # ===================================
  datasource:
    url: ${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5432/ticketcompare}
    username: ${SPRING_DATASOURCE_USERNAME:ticketuser}
    password: ${SPRING_DATASOURCE_PASSWORD:TicketPass2024!}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
      connection-timeout: 20000
      idle-timeout: 300000
      max-lifetime: 1200000

  # ===================================
  # JPA / Hibernate
  # ===================================
  jpa:
    database-platform: org.hibernate.dialect.PostgreSQLDialect
    hibernate:
      ddl-auto: ${JPA_DDL_AUTO:update}
    show-sql: ${JPA_SHOW_SQL:false}
    properties:
      hibernate:
        format_sql: false
        jdbc:
          batch_size: 20
        order_inserts: true
        order_updates: true

  sql:
    init:
      mode: never

  # ===================================
  # Thymeleaf (Production)
  # ===================================
  thymeleaf:
    cache: true

  # ===================================
  # Upload de fichiers
  # ===================================
  servlet:
    multipart:
      max-file-size: ${MAX_FILE_SIZE:10MB}
      max-request-size: ${MAX_REQUEST_SIZE:10MB}

# ===================================
# Serveur (Production)
# ===================================
server:
  port: ${SERVER_PORT:8080}
  servlet:
    context-path: ${SERVER_SERVLET_CONTEXT_PATH:/}
    session:
      cookie:
        path: /
        http-only: true
        secure: false
  forward-headers-strategy: framework
  tomcat:
    remoteip:
      remote-ip-header: X-Forwarded-For
      protocol-header: X-Forwarded-Proto
      internal-proxies: 10\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}|172\\.(1[6-9]|2\\d|3[01])\\.\\d{1,3}\\.\\d{1,3}|192\\.168\\.\\d{1,3}\\.\\d{1,3}|100\\.([6-9]\\d|1[0-2]\\d)\\.\\d{1,3}\\.\\d{1,3}
  compression:
    enabled: true
    mime-types: text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json
  error:
    include-message: always
    include-binding-errors: always
    include-stacktrace: never

# ===================================
# Actuator (Health checks)
# ===================================
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always
  metrics:
    export:
      prometheus:
        enabled: true

# ===================================
# Tesseract OCR
# ===================================
tesseract:
  ocr:
    language: fra+eng
    datapath: ${TESSERACT_DATAPATH:/usr/share/tessdata}

# ===================================
# Logging (Production)
# ===================================
logging:
  level:
    root: WARN
    pheninux.xdev.ticketcompare: INFO
    org.springframework.web: INFO
    org.hibernate.SQL: WARN
  file:
    name: /app/logs/ticketcompare.log
    max-size: 10MB
    max-history: 30
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

